<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Turni</title>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css' rel='stylesheet' />
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #2E2E2E;
            color: #EAEAEA;
            margin: 0;
            padding: 2rem;
        }
        h1 {
            text-align: center;
            color: #F1C40F;
            margin-bottom: 1rem;
        }
        .calendar-container {
            max-width: 1200px;
            margin: auto;
        }
        .fc-daygrid-day-number {
            color: #EAEAEA; /* Colore del numero dei giorni */
        }
        .fc-day-sun {
            background-color: #E74C3C !important; /* Colore rosso per le domeniche */
            color: white !important;
        }
        .fc-event-giornaliero {
            background-color: #F1C40F !important; /* Colore giallo per il turno giornaliero */
        }
        .fc-event-pomeriggio {
            background-color: #00BFFF !important; /* Colore celeste per il turno pomeridiano */
        }
        .fc-event-mattino {
            background-color: #FFA500 !important; /* Colore arancione per il turno mattutino */
        }
        .fc-daygrid-day-event {
            border-radius: 0 !important; /* Rimuovi il bordo */
        }
        .fc-daygrid-day-content {
            position: relative;
        }
        .fc-daygrid-day-content::after {
            content: attr(data-event);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            color: #EAEAEA;
            padding: 0.2rem;
            border-radius: 0.3rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <h1>Calendario Turni</h1>
        <div id='calendar'></div>
    </div>

    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js'></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,dayGridWeek,dayGridDay'
                },
                initialView: 'dayGridMonth',
                locale: 'it', // Imposta la localizzazione su italiano
                dayHeaderFormat: { weekday: 'long' }, // Usa il formato del giorno della settimana lungo
                editable: true,
                events: generateEvents(),
                dayCellDidMount: function(info) {
                    // Evidenzia le domeniche
                    const date = info.date;
                    if (date.getDay() === 0) {
                        info.el.classList.add('fc-day-sun');
                    }

                    // Aggiungi le etichette dei turni
                    const events = calendar.getEvents().filter(event => {
                        const eventDate = new Date(event.start);
                        return eventDate.toDateString() === date.toDateString();
                    });
                    if (events.length) {
                        info.el.setAttribute('data-event', events.map(e => e.title).join(', '));
                    }
                }
            });

            calendar.render();
        });

        function generateEvents() {
            const events = [];
            const startDate = new Date(2024, 8, 2); // 2 settembre 2024
            const turnDuration = 7; // Durata di un turno in giorni
            const repeatInterval = 21; // Intervallo di ripetizione in giorni

            // Turno Giornaliero
            addRepeatingEvent(events, 'Giornaliero', 'fc-event-giornaliero', startDate, turnDuration, repeatInterval);

            // Turno Pomeridiano
            const pmStartDate = new Date(2024, 8, 9); // 9 settembre 2024
            addRepeatingEvent(events, 'Pomeriggio', 'fc-event-pomeriggio', pmStartDate, 5, repeatInterval, { weekdays: [1, 2, 3, 4, 5] });

            // Turno Mattino
            const amStartDate = new Date(2024, 8, 16); // 16 settembre 2024
            addRepeatingEvent(events, 'Mattino', 'fc-event-mattino', amStartDate, 7, repeatInterval);

            return events;
        }

        function addRepeatingEvent(events, title, className, startDate, duration, interval, options = {}) {
            for (let i = 0; i < 12; i++) { // Limita a 12 mesi di eventi
                const start = new Date(startDate);
                start.setDate(start.getDate() + (i * interval));
                const end = new Date(start);
                end.setDate(end.getDate() + duration - 1);

                // Escludi le domeniche per gli eventi
                if (options.weekdays) {
                    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                        if (d.getDay() === 0 || !options.weekdays.includes(d.getDay())) {
                            continue;
                        }
                        events.push({
                            title: title,
                            start: d.toISOString().split('T')[0],
                            end: d.toISOString().split('T')[0],
                            className: className,
                            extendedProps: {
                                description: `Inizio: ${start.toLocaleDateString()} - Fine: ${end.toLocaleDateString()}.`
                            }
                        });
                    }
                } else {
                    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                        if (d.getDay() === 0) {
                            continue;
                        }
                        events.push({
                            title: title,
                            start: d.toISOString().split('T')[0],
                            end: d.toISOString().split('T')[0],
                            className: className,
                            extendedProps: {
                                description: `Inizio: ${start.toLocaleDateString()} - Fine: ${end.toLocaleDateString()}.`
                            }
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>
